#' GeneAbbr: Generate City Name Abbreviations
#'
#' @description
#' 根据预定义的规则生成中国地级行政区名称的缩写形式。多数情况下，移除行政区后缀（如“市”、“地区”、“盟”、“州”）后取前2-3个字符作为缩写，但针对例外情况需手动重命名。
#'
#' @details
#' **缩写规则**：
#' - **保留全名的例外**：如 "宜昌地区"、"张家口地区" 等特定行政区名称直接保留原名称（完整列表见代码）。
#' - **特殊替换**：针对部分历史名称或易混淆名称进行一对一替换，例如 "浑江市"→"白山"、"襄樊市"→"襄阳"。
#' - **自治州处理**：以“州”结尾的名称（如自治州）取前2个字符（如 "湘西土家族苗族自治州"→"湘西"）。
#' - **默认规则**：移除常见后缀（`市|地区|盟`），如 "南京市"→"南京"、"沧州地区"→"沧州"。
#'
#' @param vars 字符向量，输入需要处理的地级行政区原始名称（如 `c("南京市", "宜昌地区")`）。
#' @return 与输入等长的字符向量，返回处理后的缩写名称。
#' @examples
#' \donttest{
#' geneAbbr(c("宜昌地区", "梧州地区", "锦西市", "南京市"))
#' # 返回：c("宜昌地区", "梧州地区", "葫芦岛", "南京")
#'
#' geneAbbr(c("思茅地区", "伊犁哈萨克自治州", "西双版纳傣族自治州"))
#' # 返回：c("普洱", "伊犁州", "西双版纳")
#' }
#' @note
#' - 函数依赖 `tidyverse` 中的 `stringr` 包，使用前需确保已加载。
#' - 若发现未覆盖的例外名称，需在函数内 `case_when` 中添加新规则。
#' @references
#' 基于中国民政部行政区划历史名称整理，部分缩写参考通用地理习惯。
#' @export

geneAbbr <-
    function(vars) {
        require(tidyverse)
        case_when(
            {{ vars }} %in%
                c("宜昌地区", "张家口地区", "承德地区",
                  "保定地区", "沧州地区", "石家庄地区",
                  "邢台地区", "邯郸地区", "梧州地区", "柳州地区",
                  "桂林地区", "南宁地区", "伊犁地区") ~ {{ vars }},
            str_detect({{ vars }}, "鄂西") ~ "恩施",
            {{ vars }} == "银南地区" ~ "吴忠",
            {{ vars }} == "锦西市" ~ "葫芦岛",
            {{ vars }} == "浑江市" ~ "白山",
            {{ vars }} == "达川地区" ~ "达州",
            {{ vars }} == "郧阳地区" ~ "随州",
            {{ vars }} == "大庸市" ~ "张家界",
            {{ vars }} == "零陵地区" ~ "永州",
            {{ vars }} == "伊犁哈萨克自治州" ~ "伊犁州",
            {{ vars }} == "伊克昭盟" ~ "鄂尔多斯",
            {{ vars }} == "哲里木盟" ~ "通辽",
            {{ vars }} == "宿县地区" ~ "宿州",
            {{ vars }} == "思茅地区" ~ "普洱",
            {{ vars }} == "思茅市" ~ "普洱",
            {{ vars }} == "襄樊市" ~ "襄阳",
            {{ vars }} == "淮阴市" ~ "淮安",
            {{ vars }} == "克孜勒苏柯尔克孜自治州" ~ "克孜勒苏",
            {{ vars }} == "博尔塔拉蒙古自治州" ~ "博尔塔拉",
            {{ vars }} == "巴音郭楞蒙古自治州" ~ "巴音郭楞",
            {{ vars }} == "西双版纳傣族自治州" ~ "西双版纳",
            {{ vars }} == "黔东南苗族侗族自治州" ~ "黔东南",
            {{ vars }} == "黔西南布依族苗族自治州" ~ "黔西南",
            str_detect({{ vars }}, "州$") ~ str_sub({{ vars }}, 1, 2),
            TRUE ~ str_remove({{ vars }}, "((市)|(地区)|(盟))$")
        )
    }

